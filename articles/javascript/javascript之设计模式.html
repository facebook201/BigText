<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript之设计模式 | 前端WebGL</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/WebGLbolg/assets/css/0.styles.87624398.css" as="style"><link rel="preload" href="/WebGLbolg/assets/js/app.a1e9572c.js" as="script"><link rel="preload" href="/WebGLbolg/assets/js/2.918eef7d.js" as="script"><link rel="preload" href="/WebGLbolg/assets/js/1.dd66940c.js" as="script"><link rel="preload" href="/WebGLbolg/assets/js/163.b6b640bb.js" as="script"><link rel="preload" href="/WebGLbolg/assets/js/107.54b8d7a7.js" as="script"><link rel="prefetch" href="/WebGLbolg/assets/js/10.64c82640.js"><link rel="prefetch" href="/WebGLbolg/assets/js/100.e56f3d4b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/101.78abdadc.js"><link rel="prefetch" href="/WebGLbolg/assets/js/102.f454ea53.js"><link rel="prefetch" href="/WebGLbolg/assets/js/103.b0e82897.js"><link rel="prefetch" href="/WebGLbolg/assets/js/104.3deb87ae.js"><link rel="prefetch" href="/WebGLbolg/assets/js/105.23b41508.js"><link rel="prefetch" href="/WebGLbolg/assets/js/106.086b4494.js"><link rel="prefetch" href="/WebGLbolg/assets/js/108.b193a4ac.js"><link rel="prefetch" href="/WebGLbolg/assets/js/109.accc59d9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/11.df70a63f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/110.1ef2937e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/111.e4c2e31e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/112.fcaf75c7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/113.23cfa266.js"><link rel="prefetch" href="/WebGLbolg/assets/js/114.d333e2d0.js"><link rel="prefetch" href="/WebGLbolg/assets/js/115.0973b0d5.js"><link rel="prefetch" href="/WebGLbolg/assets/js/116.52da1a90.js"><link rel="prefetch" href="/WebGLbolg/assets/js/117.6943341d.js"><link rel="prefetch" href="/WebGLbolg/assets/js/118.7e05a5f7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/119.855dae69.js"><link rel="prefetch" href="/WebGLbolg/assets/js/12.5892dabf.js"><link rel="prefetch" href="/WebGLbolg/assets/js/120.91c31cb1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/121.e424f641.js"><link rel="prefetch" href="/WebGLbolg/assets/js/122.4bbcea02.js"><link rel="prefetch" href="/WebGLbolg/assets/js/123.940ed7ea.js"><link rel="prefetch" href="/WebGLbolg/assets/js/124.6443d972.js"><link rel="prefetch" href="/WebGLbolg/assets/js/125.1fff4716.js"><link rel="prefetch" href="/WebGLbolg/assets/js/126.660b754f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/127.90c65672.js"><link rel="prefetch" href="/WebGLbolg/assets/js/128.6ecab9e1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/129.ace967e4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/13.c0d3690d.js"><link rel="prefetch" href="/WebGLbolg/assets/js/130.522f925e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/131.18ad428f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/132.6de70f31.js"><link rel="prefetch" href="/WebGLbolg/assets/js/133.211c4628.js"><link rel="prefetch" href="/WebGLbolg/assets/js/134.021940f6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/135.0b28f817.js"><link rel="prefetch" href="/WebGLbolg/assets/js/136.50170e96.js"><link rel="prefetch" href="/WebGLbolg/assets/js/137.7b0f43f3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/138.d82d46d9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/139.4f20c255.js"><link rel="prefetch" href="/WebGLbolg/assets/js/14.3f90cad7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/140.c58e91bf.js"><link rel="prefetch" href="/WebGLbolg/assets/js/141.8e389061.js"><link rel="prefetch" href="/WebGLbolg/assets/js/142.a2539e36.js"><link rel="prefetch" href="/WebGLbolg/assets/js/143.eefb9561.js"><link rel="prefetch" href="/WebGLbolg/assets/js/144.02687791.js"><link rel="prefetch" href="/WebGLbolg/assets/js/145.1561c536.js"><link rel="prefetch" href="/WebGLbolg/assets/js/146.43548e82.js"><link rel="prefetch" href="/WebGLbolg/assets/js/147.a40db09a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/148.083dea98.js"><link rel="prefetch" href="/WebGLbolg/assets/js/149.e7c1bc6f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/15.0382753a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/150.170c3adf.js"><link rel="prefetch" href="/WebGLbolg/assets/js/151.04077552.js"><link rel="prefetch" href="/WebGLbolg/assets/js/152.c19127ee.js"><link rel="prefetch" href="/WebGLbolg/assets/js/153.4be9c720.js"><link rel="prefetch" href="/WebGLbolg/assets/js/154.7f2fe97e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/155.1df5780e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/156.b09cccc6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/157.2f88c2f7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/158.3b35883a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/159.64edadc7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/16.ca202bd8.js"><link rel="prefetch" href="/WebGLbolg/assets/js/160.a1d5c0a4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/161.bca72816.js"><link rel="prefetch" href="/WebGLbolg/assets/js/162.d8d3eed1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/164.423ea1c6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/165.2537016f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/166.3f73fc07.js"><link rel="prefetch" href="/WebGLbolg/assets/js/167.a3f09db5.js"><link rel="prefetch" href="/WebGLbolg/assets/js/168.c29d9d1e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/169.a3a8cc06.js"><link rel="prefetch" href="/WebGLbolg/assets/js/17.79bd023c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/170.08cf1ef4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/171.63c3135c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/172.de3c8ddd.js"><link rel="prefetch" href="/WebGLbolg/assets/js/173.71cd38d6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/174.b9ea578c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/175.370c4bd0.js"><link rel="prefetch" href="/WebGLbolg/assets/js/176.b14d6831.js"><link rel="prefetch" href="/WebGLbolg/assets/js/177.6a0e7d2b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/178.3cdb1800.js"><link rel="prefetch" href="/WebGLbolg/assets/js/179.9b8c1733.js"><link rel="prefetch" href="/WebGLbolg/assets/js/18.019a7c67.js"><link rel="prefetch" href="/WebGLbolg/assets/js/180.5ad3ad4f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/181.24361fce.js"><link rel="prefetch" href="/WebGLbolg/assets/js/182.5b8c95b5.js"><link rel="prefetch" href="/WebGLbolg/assets/js/183.02b14c61.js"><link rel="prefetch" href="/WebGLbolg/assets/js/184.804627d0.js"><link rel="prefetch" href="/WebGLbolg/assets/js/185.d3dc237f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/186.9f341504.js"><link rel="prefetch" href="/WebGLbolg/assets/js/187.80e71c52.js"><link rel="prefetch" href="/WebGLbolg/assets/js/188.1530f52d.js"><link rel="prefetch" href="/WebGLbolg/assets/js/189.fe92e468.js"><link rel="prefetch" href="/WebGLbolg/assets/js/19.7c15232c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/190.421bce40.js"><link rel="prefetch" href="/WebGLbolg/assets/js/191.222a15a9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/192.a5ff4c2b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/193.b57cf720.js"><link rel="prefetch" href="/WebGLbolg/assets/js/194.8290160e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/195.11d74bd3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/196.f5e4fc88.js"><link rel="prefetch" href="/WebGLbolg/assets/js/197.695ec53f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/198.b3f0ac16.js"><link rel="prefetch" href="/WebGLbolg/assets/js/199.9e265f46.js"><link rel="prefetch" href="/WebGLbolg/assets/js/20.becddea5.js"><link rel="prefetch" href="/WebGLbolg/assets/js/200.3a276c3c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/201.be17e360.js"><link rel="prefetch" href="/WebGLbolg/assets/js/202.111dfc1b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/203.c2de3e3a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/204.7b1b7192.js"><link rel="prefetch" href="/WebGLbolg/assets/js/205.65f93b9e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/206.30550734.js"><link rel="prefetch" href="/WebGLbolg/assets/js/207.ba12be14.js"><link rel="prefetch" href="/WebGLbolg/assets/js/208.60bac301.js"><link rel="prefetch" href="/WebGLbolg/assets/js/209.5a0e2a72.js"><link rel="prefetch" href="/WebGLbolg/assets/js/21.2abc4662.js"><link rel="prefetch" href="/WebGLbolg/assets/js/210.aade8a85.js"><link rel="prefetch" href="/WebGLbolg/assets/js/211.aaf7aee8.js"><link rel="prefetch" href="/WebGLbolg/assets/js/212.13611c18.js"><link rel="prefetch" href="/WebGLbolg/assets/js/213.ea8d9dfa.js"><link rel="prefetch" href="/WebGLbolg/assets/js/214.66f0bbd1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/215.7b28b2ae.js"><link rel="prefetch" href="/WebGLbolg/assets/js/216.446b2a83.js"><link rel="prefetch" href="/WebGLbolg/assets/js/217.41f3b35f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/218.5e1ebe7d.js"><link rel="prefetch" href="/WebGLbolg/assets/js/219.188b76ba.js"><link rel="prefetch" href="/WebGLbolg/assets/js/22.888a21ed.js"><link rel="prefetch" href="/WebGLbolg/assets/js/220.ebcde46f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/221.b93a679f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/222.4a0488e7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/223.7e96b987.js"><link rel="prefetch" href="/WebGLbolg/assets/js/224.402e47ee.js"><link rel="prefetch" href="/WebGLbolg/assets/js/225.c3b28fef.js"><link rel="prefetch" href="/WebGLbolg/assets/js/226.131260c6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/227.9c14cf2b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/228.ebfd1bbd.js"><link rel="prefetch" href="/WebGLbolg/assets/js/229.e6da2321.js"><link rel="prefetch" href="/WebGLbolg/assets/js/23.3adf2e7b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/230.e224cdfc.js"><link rel="prefetch" href="/WebGLbolg/assets/js/231.cf4bd793.js"><link rel="prefetch" href="/WebGLbolg/assets/js/232.f52d2707.js"><link rel="prefetch" href="/WebGLbolg/assets/js/233.ecb7afc9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/234.f6f02f99.js"><link rel="prefetch" href="/WebGLbolg/assets/js/235.879bddf3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/236.7a243bc2.js"><link rel="prefetch" href="/WebGLbolg/assets/js/237.f098433f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/238.7532a22e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/239.25286c81.js"><link rel="prefetch" href="/WebGLbolg/assets/js/24.33be9616.js"><link rel="prefetch" href="/WebGLbolg/assets/js/240.08f3a81e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/241.b73ee63d.js"><link rel="prefetch" href="/WebGLbolg/assets/js/242.a7e61efe.js"><link rel="prefetch" href="/WebGLbolg/assets/js/243.e5f005de.js"><link rel="prefetch" href="/WebGLbolg/assets/js/244.41103dba.js"><link rel="prefetch" href="/WebGLbolg/assets/js/245.41713f58.js"><link rel="prefetch" href="/WebGLbolg/assets/js/246.5406372b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/247.fd253333.js"><link rel="prefetch" href="/WebGLbolg/assets/js/248.8704a9bc.js"><link rel="prefetch" href="/WebGLbolg/assets/js/249.69874bf9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/25.06be0c63.js"><link rel="prefetch" href="/WebGLbolg/assets/js/250.499b6d2b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/251.d6cdcca1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/252.b234b9dd.js"><link rel="prefetch" href="/WebGLbolg/assets/js/253.b23a1938.js"><link rel="prefetch" href="/WebGLbolg/assets/js/254.e27479af.js"><link rel="prefetch" href="/WebGLbolg/assets/js/255.be58fcee.js"><link rel="prefetch" href="/WebGLbolg/assets/js/256.d9d53f5a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/257.9f97bfde.js"><link rel="prefetch" href="/WebGLbolg/assets/js/258.a39b58dc.js"><link rel="prefetch" href="/WebGLbolg/assets/js/259.85fd0cde.js"><link rel="prefetch" href="/WebGLbolg/assets/js/26.27bd6979.js"><link rel="prefetch" href="/WebGLbolg/assets/js/260.baa8d487.js"><link rel="prefetch" href="/WebGLbolg/assets/js/261.9ad7257e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/262.81139fd9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/263.f792f2a8.js"><link rel="prefetch" href="/WebGLbolg/assets/js/264.abd8bcb7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/265.26a3f45c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/266.7dcfaa3c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/267.f988e20e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/268.e94bcac4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/269.7a10a775.js"><link rel="prefetch" href="/WebGLbolg/assets/js/27.7cf8264e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/270.24c850fe.js"><link rel="prefetch" href="/WebGLbolg/assets/js/271.955d009f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/272.a3f3d9a0.js"><link rel="prefetch" href="/WebGLbolg/assets/js/273.3746215f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/274.c7783d38.js"><link rel="prefetch" href="/WebGLbolg/assets/js/275.a31f8bcb.js"><link rel="prefetch" href="/WebGLbolg/assets/js/276.a5793408.js"><link rel="prefetch" href="/WebGLbolg/assets/js/277.573150e2.js"><link rel="prefetch" href="/WebGLbolg/assets/js/28.3fe8a3b1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/29.cd77fc44.js"><link rel="prefetch" href="/WebGLbolg/assets/js/3.078209c2.js"><link rel="prefetch" href="/WebGLbolg/assets/js/30.159abf4f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/31.d922fcf9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/32.38f16161.js"><link rel="prefetch" href="/WebGLbolg/assets/js/33.bdad240e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/34.f2bbc2d1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/35.f7e3bb27.js"><link rel="prefetch" href="/WebGLbolg/assets/js/36.debe7217.js"><link rel="prefetch" href="/WebGLbolg/assets/js/37.c79289e4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/38.8afeb2de.js"><link rel="prefetch" href="/WebGLbolg/assets/js/39.f469328a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/4.8fe7a186.js"><link rel="prefetch" href="/WebGLbolg/assets/js/40.ba9dfbc6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/41.54cd742c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/42.228a11b6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/43.5acacb46.js"><link rel="prefetch" href="/WebGLbolg/assets/js/44.b5c9cb99.js"><link rel="prefetch" href="/WebGLbolg/assets/js/45.318b164c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/46.a90ddf9f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/47.5d759830.js"><link rel="prefetch" href="/WebGLbolg/assets/js/48.3ecc3af7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/49.96a3c8bc.js"><link rel="prefetch" href="/WebGLbolg/assets/js/5.5967bee8.js"><link rel="prefetch" href="/WebGLbolg/assets/js/50.f288fa25.js"><link rel="prefetch" href="/WebGLbolg/assets/js/51.a0dc928a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/52.e5dc9281.js"><link rel="prefetch" href="/WebGLbolg/assets/js/53.3713556c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/54.101160d6.js"><link rel="prefetch" href="/WebGLbolg/assets/js/55.eb9e175b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/56.3d6caedb.js"><link rel="prefetch" href="/WebGLbolg/assets/js/57.110a795f.js"><link rel="prefetch" href="/WebGLbolg/assets/js/58.54091307.js"><link rel="prefetch" href="/WebGLbolg/assets/js/59.3b49a2c9.js"><link rel="prefetch" href="/WebGLbolg/assets/js/6.17dcb484.js"><link rel="prefetch" href="/WebGLbolg/assets/js/60.d40de169.js"><link rel="prefetch" href="/WebGLbolg/assets/js/61.01cba0d1.js"><link rel="prefetch" href="/WebGLbolg/assets/js/62.47dfde10.js"><link rel="prefetch" href="/WebGLbolg/assets/js/63.17ae1881.js"><link rel="prefetch" href="/WebGLbolg/assets/js/64.748ddae2.js"><link rel="prefetch" href="/WebGLbolg/assets/js/65.db782f19.js"><link rel="prefetch" href="/WebGLbolg/assets/js/66.bb039d08.js"><link rel="prefetch" href="/WebGLbolg/assets/js/67.30f4b13b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/68.5123e6bb.js"><link rel="prefetch" href="/WebGLbolg/assets/js/69.4c3f94a4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/7.28c1da78.js"><link rel="prefetch" href="/WebGLbolg/assets/js/70.1879d3dd.js"><link rel="prefetch" href="/WebGLbolg/assets/js/71.650c0862.js"><link rel="prefetch" href="/WebGLbolg/assets/js/72.37939565.js"><link rel="prefetch" href="/WebGLbolg/assets/js/73.5b972ab5.js"><link rel="prefetch" href="/WebGLbolg/assets/js/74.de710fef.js"><link rel="prefetch" href="/WebGLbolg/assets/js/75.04505cda.js"><link rel="prefetch" href="/WebGLbolg/assets/js/76.83fd9cc3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/77.85cc78f2.js"><link rel="prefetch" href="/WebGLbolg/assets/js/78.0374c2f3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/79.870e06b7.js"><link rel="prefetch" href="/WebGLbolg/assets/js/80.9e36da2c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/81.6ccabcda.js"><link rel="prefetch" href="/WebGLbolg/assets/js/82.b0eb7a5c.js"><link rel="prefetch" href="/WebGLbolg/assets/js/83.98170b69.js"><link rel="prefetch" href="/WebGLbolg/assets/js/84.4155a155.js"><link rel="prefetch" href="/WebGLbolg/assets/js/85.aa0d4a14.js"><link rel="prefetch" href="/WebGLbolg/assets/js/86.00f48e60.js"><link rel="prefetch" href="/WebGLbolg/assets/js/87.ff3adcc3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/88.5b80cf55.js"><link rel="prefetch" href="/WebGLbolg/assets/js/89.77ed0897.js"><link rel="prefetch" href="/WebGLbolg/assets/js/90.cd22f9c4.js"><link rel="prefetch" href="/WebGLbolg/assets/js/91.c1f0345a.js"><link rel="prefetch" href="/WebGLbolg/assets/js/92.9945783e.js"><link rel="prefetch" href="/WebGLbolg/assets/js/93.b24304e8.js"><link rel="prefetch" href="/WebGLbolg/assets/js/94.29e1535b.js"><link rel="prefetch" href="/WebGLbolg/assets/js/95.065243a3.js"><link rel="prefetch" href="/WebGLbolg/assets/js/96.2bba6499.js"><link rel="prefetch" href="/WebGLbolg/assets/js/97.b91b5b60.js"><link rel="prefetch" href="/WebGLbolg/assets/js/98.c69ee606.js"><link rel="prefetch" href="/WebGLbolg/assets/js/99.235adf16.js"><link rel="prefetch" href="/WebGLbolg/assets/js/vendors~docsearch.34249538.js">
    <link rel="stylesheet" href="/WebGLbolg/assets/css/0.styles.87624398.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/WebGLbolg/" class="home-link router-link-active"><!----> <span class="site-name">前端WebGL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/WebGLbolg/articles/webgl/" class="nav-link">
  图形学
</a></div><div class="nav-item"><a href="/WebGLbolg/articles/threejs/" class="nav-link">
  threejs
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/WebGLbolg/articles/webgl/" class="nav-link">
  图形学
</a></div><div class="nav-item"><a href="/WebGLbolg/articles/threejs/" class="nav-link">
  threejs
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/WebGLbolg/articles/javascript/" aria-current="page" class="sidebar-link">js变量声明提升</a></li><li><a href="/WebGLbolg/articles/javascript/co函数的理解.html" class="sidebar-link">co函数的理解</a></li><li><a href="/WebGLbolg/articles/javascript/ES6和ES5的继承有什么区别.html" class="sidebar-link">ES6和ES5的继承的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之call、apply、及bind的源码实现.html" class="sidebar-link">call、apply、及bind的源码实现</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之EventLoop.html" class="sidebar-link">javascript之EventLoop</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之Object.freeze和Object.Seal()的区别.html" class="sidebar-link">Object.freeze和Object.Seal()的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之prototype和__proto__区别.html" class="sidebar-link">prototype和_proto_区别​</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之this详解.html" class="sidebar-link">javascript之this详解</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之url重定向和url重写的区别.html" class="sidebar-link">url重定向和url重写的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之WebWorker详解.html" class="sidebar-link">javascript之WebWorker详解</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之事件总结.html" class="sidebar-link">javascript之事件总结</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之从URL输入到页面展现到底发生什么.html" class="sidebar-link">从URL输入到页面展现到底发生什么</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之函数的执行机制详解.html" class="sidebar-link">javascript之函数的执行机制详解</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之初始化构造函数时new所起的作用.html" class="sidebar-link">初始化构造函数时new所起的作用</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之客户端缓存和服务器缓存的区别.html" class="sidebar-link">客户端缓存和服务器缓存的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之对象的常见创建和继承方式总结.html" class="sidebar-link">对象的常见创建和继承方式</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之底层执行机制详解-待完成.html" class="sidebar-link">javascript之底层执行机制详解</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之异步解决方案总结.html" class="sidebar-link">javascript之异步解决方案总结</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之性能提升之路.html" class="sidebar-link">javascript之性能提升之路</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之执行上下文详解.html" class="sidebar-link">javascript之执行上下文详解</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之数据类型及其转换规则.html" class="sidebar-link">js数据类型及其常见用法</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之数组去重的几种方法.html" class="sidebar-link">数组去重的几种方法</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之浏览器的执行原理.html" class="sidebar-link">浏览器的执行原理</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之深浅拷贝的区别.html" class="sidebar-link">javascript之深浅拷贝的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html" class="active sidebar-link">javascript之设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#一、设计模式分类" class="sidebar-link">一、设计模式分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_1、单例模式" class="sidebar-link">1、单例模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_2、策略模式" class="sidebar-link">2、策略模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_3、代理模式" class="sidebar-link">3、代理模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_4、迭代器模式" class="sidebar-link">4、迭代器模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_5、发布订阅模式" class="sidebar-link">5、发布订阅模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_6、命令模式" class="sidebar-link">6、命令模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_7、组合模式" class="sidebar-link">7、组合模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_8、模板方法模式" class="sidebar-link">8、模板方法模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_9、享元模式" class="sidebar-link">9、享元模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_10、职责链模式" class="sidebar-link">10、职责链模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_11、中介者模式" class="sidebar-link">11、中介者模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_12、装饰器模式" class="sidebar-link">12、装饰器模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_13、状态模式" class="sidebar-link">13、状态模式</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_14、适配器模式" class="sidebar-link">14、适配器模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#二、设计原则和编程技巧" class="sidebar-link">二、设计原则和编程技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_1、第一职责原则" class="sidebar-link">1、第一职责原则</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_2、最少知识原则" class="sidebar-link">2、最少知识原则</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_3、开放封闭原则" class="sidebar-link">3、开放封闭原则</a></li><li class="sidebar-sub-header"><a href="/WebGLbolg/articles/javascript/javascript之设计模式.html#_4、代码重构" class="sidebar-link">4、代码重构</a></li></ul></li></ul></li><li><a href="/WebGLbolg/articles/javascript/javascript之闭包.html" class="sidebar-link">javascript之闭包</a></li><li><a href="/WebGLbolg/articles/javascript/javascrit之undefined和null的区别.html" class="sidebar-link">undefined和null的区别</a></li><li><a href="/WebGLbolg/articles/javascript/javscript之Object.defineProperty.html" class="sidebar-link">Object.defineProperty​详解</a></li><li><a href="/WebGLbolg/articles/javascript/js四种数据类型检测的底层机制总结.html" class="sidebar-link">js四种数据类型检测的底层机制总结</a></li><li><a href="/WebGLbolg/articles/javascript/函数式编程之compose函数和pipe的实现.html" class="sidebar-link">函数式编程之compose函数和pipe的实现</a></li><li><a href="/WebGLbolg/articles/javascript/函数式编程之函数柯里化及偏函数.html" class="sidebar-link">函数式编程之函数柯里化及偏函数</a></li><li><a href="/WebGLbolg/articles/javascript/函数式编程之函数防抖与节流.html" class="sidebar-link">函数式编程之函数防抖与节流</a></li><li><a href="/WebGLbolg/articles/javascript/前端代码异步捕获方法总结.html" class="sidebar-link">前端代码异步捕获方法总结</a></li><li><a href="/WebGLbolg/articles/javascript/前端常见面试考点.html" class="sidebar-link">前端常见面试考点</a></li><li><a href="/WebGLbolg/articles/javascript/前端跨域的9种解决方案.html" class="sidebar-link">前端跨域的9种解决方案</a></li><li><a href="/WebGLbolg/articles/javascript/常见函数源码的实现.html" class="sidebar-link">常见函数源码的实现</a></li><li><a href="/WebGLbolg/articles/javascript/浏览器底层渲染机制.html" class="sidebar-link">浏览器地层渲染机制</a></li><li><a href="/WebGLbolg/articles/javascript/面向对象常见面试考点.html" class="sidebar-link">面向对象常见面试考点</a></li><li><a href="/WebGLbolg/articles/javascript/高阶函数的源码实现.html" class="sidebar-link">高阶函数的源码实现</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、设计模式分类"><a href="#一、设计模式分类" class="header-anchor">#</a> 一、设计模式分类</h2> <h3 id="_1、单例模式"><a href="#_1、单例模式" class="header-anchor">#</a> 1、单例模式</h3> <p><strong>定义：</strong> 保证一个类仅有一个实例，并提供一个访问它的<code>全局访问点</code>。js的常见单例对象有<code>线程池、全局缓存、浏览器中的window对象</code>。</p> <p><strong>实现原理：</strong> 用一个变量来标志是否已经为某个类创建过实例对象，如果创建过，这在下一次获取该类的实例时，直接返回之前创建的实例对象。</p> <p><strong>优点：</strong></p> <p>单例模式的代码实现如下：</p> <ul><li>类的单例设计模式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 测试</span>
<span class="token keyword">let</span> a<span class="token operator">=</span>Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b<span class="token operator">=</span>Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">===</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
</code></pre></div><ul><li>对象的单例设计模式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> utils<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        query<span class="token punctuation">,</span>
        css
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>惰性单例模式：</strong> 将创建对象和管理单例的逻辑分开。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//将管理单例的逻辑封装成一个方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">getSingle</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> instance<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance <span class="token operator">||</span><span class="token punctuation">(</span>instance<span class="token operator">=</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//创建对象</span>
<span class="token keyword">const</span>  <span class="token function-variable function">createLoginLayer</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span> <span class="token string">'div'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'我是登录浮窗'</span><span class="token punctuation">;</span>     
    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>     		
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span> div <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token keyword">return</span> div<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span>  createSingleLoginLayer <span class="token operator">=</span> <span class="token function">getSingle</span><span class="token punctuation">(</span> createLoginLayer <span class="token punctuation">)</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'loginBtn'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">let</span> loginLayer <span class="token operator">=</span> <span class="token function">createSingleLoginLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    loginLayer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><hr> <h3 id="_2、策略模式"><a href="#_2、策略模式" class="header-anchor">#</a> 2、策略模式</h3> <p><strong>定义：</strong> 定义一系列的算法，把它们各自封装成策略，算法被封装在策略内部。根据不同参数来命中不同的策略。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//定义策略</span>
<span class="token keyword">let</span> strategies<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;S&quot;</span><span class="token operator">:</span><span class="token parameter">salary</span><span class="token operator">=&gt;</span>salary<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;A&quot;</span><span class="token operator">:</span><span class="token parameter">salary</span><span class="token operator">=&gt;</span>salary<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;B&quot;</span><span class="token operator">:</span><span class="token parameter">salary</span><span class="token operator">=&gt;</span>salary<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;C&quot;</span><span class="token operator">:</span><span class="token parameter">salary</span><span class="token operator">=&gt;</span>salary<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">//调用策略 </span>
<span class="token keyword">let</span> <span class="token function-variable function">calculateBonus</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">level<span class="token punctuation">,</span>salary</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> strategies<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>

<span class="token comment">//测试</span>
<span class="token keyword">let</span> sBonus<span class="token operator">=</span><span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">&quot;S&quot;</span><span class="token punctuation">,</span><span class="token number">40000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> aBonus<span class="token operator">=</span><span class="token function">calculateBonus</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sBonus<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//160000</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aBonus<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//90000</span>
</code></pre></div><p><strong>优点</strong></p> <ul><li>用组合、委托和多态等技术和思想，可以<code>有效的避免多重条件选择语句</code>。</li> <li>提供了对开放-闭合原则的完美支持，将算法封装在独立的<code>strategy</code>中，使得它们易于切换、易于理解，易于扩展。</li> <li>可以避免许多重复的粘贴工作。</li> <li>是继承的一种更轻便的替换方案。</li></ul> <p><strong>缺点</strong></p> <ul><li><p>要向用户暴露策略的所有实现，违反了最少知识原则。</p></li> <li><p>要使用策略模式，首先得了解所有的<code>stratigy</code>。</p></li></ul> <hr> <h3 id="_3、代理模式"><a href="#_3、代理模式" class="header-anchor">#</a> 3、代理模式</h3> <p><strong>定义：</strong> 为一个对象提供一个代用品或占位符，以便控制对它的访问。代理模式的关键点：<code>当用户直接访问一个对象或者不满足需求的时候，提供一个替身对象对这个对象的访问。</code></p> <p>代理模式分为<strong>保护代理和虚拟代理</strong>。</p> <p><strong>1、虚拟代理：</strong> 将一些开销很大的对象，延迟到真正需要它的才去创建。</p> <p><strong>1）、用虚拟代理实现图片预加载</strong></p> <p><strong>思路：</strong> 先用一张loading图片占位，然后用异步的方式加载图片，等图片加载好了再将它填充到img节点里。</p> <p><strong>代理的意义：</strong> 负责预加载图片，预加载的操作完成后，把请求交给本体myImage。符合单一职责原则——（<code>一个类或者一个对象和函数</code>），应该仅有一个引起它变化的原因。</p> <p><strong>好处：</strong></p> <ul><li>1、用户可以放心的请求代理，只用关心能否得到想要的结果。</li> <li>2、在任何使用本体的地方都可以替换成使用代理。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//功能：给img节点设置src</span>
<span class="token keyword">let</span> myImage<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> imfNode<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         imgNode<span class="token punctuation">.</span>src<span class="token operator">=</span>src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//功能:图片预加载</span>
<span class="token keyword">let</span> proxyImage<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//图片预加载</span>
    <span class="token keyword">let</span> img<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//真正的图片加载成功时触发，此时的图片资源已经下载好了</span>
        <span class="token function">myImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//添加默认图片占位</span>
        <span class="token function">myImage</span><span class="token punctuation">(</span><span class="token string">&quot;http://pic44.nipic.com/20140723/18505720_094503373000_2.jpg&quot;</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>src<span class="token operator">=</span>src<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">proxyImage</span><span class="token punctuation">(</span><span class="token string">&quot;http://pic44.nipic.com/20140723/18505720_094503373000_2.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>2)、虚拟代理合并http请求</strong></p> <p><strong>思路:</strong> 通过一个代理函数来收集一段时间内的请求，最后一次性的发送给服务器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">synchronousFile</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始同步文件，id为:&quot;</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> proxySynchronousFile<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> cache<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>timer<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        timer<span class="token operator">=</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">synchronousFile</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            timer<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span>length<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">proxySynchronousFile</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>2、保护代理：</strong> 代理帮助本体过滤掉一些请求。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">Flower</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> xiaoming<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token function-variable function">sendFlower</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">receiveFlower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//B属于代理对象，可以帮助A对象过滤一些请求</span>
<span class="token keyword">let</span> <span class="token constant">B</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token function-variable function">receiveFlower</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//监听A的好心情</span>
        <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">listenGoodMood</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">// new Flower()是一个大的开销对象</span>
            <span class="token keyword">let</span> flower<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Flower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">receiveFlower</span><span class="token punctuation">(</span>flower<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//目标对象</span>
<span class="token keyword">let</span> <span class="token constant">A</span><span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token function-variable function">receiveFlower</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">flower</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到花&quot;</span><span class="token operator">+</span>flower<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">listenGoodMood</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//延迟10秒</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xiaoming<span class="token punctuation">.</span><span class="token function">sendFlower</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>3、缓存代理</strong></p> <p>  缓存代理可以为一些开销大的运算结果提供暂时的存储，在下次运算时，如果传递进来的参数跟原来的一致，可以直接返回之前存储的运算结果。</p> <p>实例：缓存乘积</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">multi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> a <span class="token operator">*</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      a <span class="token operator">=</span> a <span class="token operator">+</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> a<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">proxyFactory</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> proxyMulti<span class="token operator">=</span><span class="token function">proxyFactory</span><span class="token punctuation">(</span>multi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">proxyMulti</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：24</span>
<span class="token function">proxyMulti</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：24</span>
<span class="token keyword">let</span> proxyAdd<span class="token operator">=</span><span class="token function">proxyFactory</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">proxyAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：10</span>
<span class="token function">proxyAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：10</span>
</code></pre></div><hr> <h3 id="_4、迭代器模式"><a href="#_4、迭代器模式" class="header-anchor">#</a> 4、迭代器模式</h3> <p><strong>定义：</strong> 指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。可以分为内部迭代器和外部迭代器。</p> <p><strong>好处：</strong> 可以把迭代的过程从业务逻辑中分离出来，不用关心对象的内部构造，也可以按顺序访问其中的每个元素。</p> <p><strong>内部迭代器：</strong> 函数内部已经定义好了迭代规则，外部只需要一次初始调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">each</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token operator">=</span>args<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//测试</span>
<span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//判断两个数组元素里的值是否完全相等</span>
<span class="token keyword">let</span> <span class="token function-variable function">compare</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span>arr2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>length<span class="token operator">!==</span>arr2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;arr1和arr2不相等&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">each</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">!==</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;arr1和arr2不相等&quot;</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;arr1和arr2相等&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//测试</span>
<span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">// Uncaught Error: arr1和arr2不相等</span>
</code></pre></div><p><strong>外部迭代器：</strong> 必须显示的请求迭代下一个元素。增加了调用的复杂度，同时也增强了迭代器的灵活性，可以手动控制迭代的过程或者顺序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">Iterator</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token function-variable function">next</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        index<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token function-variable function">isDone</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> index<span class="token operator">&gt;=</span>obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token function-variable function">getCurItem</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        next<span class="token punctuation">,</span>
        isDone<span class="token punctuation">,</span>
        getCurItem
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//判断两个数组元素里的值是否完全相等</span>
<span class="token keyword">let</span> <span class="token function-variable function">compare</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">iterator1<span class="token punctuation">,</span>iterator2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>iterator1<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span>iterator2<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>iterator1<span class="token punctuation">.</span><span class="token function">getCurItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!==</span>iterator2<span class="token punctuation">.</span><span class="token function">getCurItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span> <span class="token punctuation">(</span> <span class="token string">'iterator1 和 iterator2 不相等'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        iterator1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iterator2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token function">alert</span> <span class="token punctuation">(</span><span class="token string">'iterator1 和 iterator2 相等'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">var</span> iterator1 <span class="token operator">=</span> <span class="token function">Iterator</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iterator2 <span class="token operator">=</span> <span class="token function">Iterator</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">compare</span><span class="token punctuation">(</span> iterator1<span class="token punctuation">,</span> iterator2 <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// iterator1 和 iterator2 相等  </span>
</code></pre></div><p><strong>中止迭代器</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">each</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出1、2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="_5、发布订阅模式"><a href="#_5、发布订阅模式" class="header-anchor">#</a> 5、发布订阅模式</h3> <p>  又称为<code>订阅者模式</code>，它定义了对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。</p> <p><strong>缺点</strong></p> <ul><li>创建订阅者本身要消耗一定的时间和内存，当你订阅一个消息后，也许此消息最后都未发生，但是这个订阅者会始终存在内存中。</li> <li>可以弱化对象之间的联系，但是过度使用的话，对象之间的必要联系也会被深藏在背后，会导致程序难以跟踪维护和理解。</li></ul> <p><strong>优点</strong></p> <ul><li><p>时间上的解耦。</p></li> <li><p>对象之间的解耦</p></li></ul> <p><strong>实现步骤：</strong></p> <ul><li><p>首先指定谁充当发布者。</p></li> <li><p>然后给发布者添加一个缓存列表，用于存放回调函数以便通知订阅者。</p></li> <li><p>最后发布消息的时候，发布者会遍历这和缓存列表，一次触发里面存放的订阅者回调函数。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">EventBus</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//中介者</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//注册事件|监听事件（订阅者）</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//一个事件可能有多个监听者</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//触发事件(观察者)</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//给回调函数传参</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//只被触发一次的事件</span>
    <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//在这里同时完成了对该事件的注册、对该事件的触发，并在最后取消该事件。</span>
        <span class="token keyword">const</span> <span class="token function-variable function">cb</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//触发</span>
            <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//删除该订阅者</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//监听</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//取消事件</span>
    <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>offcb</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> index<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> offcb<span class="token operator">===</span>fn<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//没有人订阅该事件，则将该事件销毁</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>event<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>观察者模式</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//被观察者</span>
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Observer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
    <span class="token function">attach</span> <span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>Observer<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Observer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">setState</span> <span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> newState<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Observer<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//观察者</span>
<span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sub<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的状态改成了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sub<span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> o1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'观察者1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> o2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'观察者2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token string">&quot;发布者1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sub<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">;</span>
sub<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
sub<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">&quot;开心&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="_6、命令模式"><a href="#_6、命令模式" class="header-anchor">#</a> 6、命令模式</h3> <p>  命令模式是最简单和优雅的模式之一，命令模式中的<code>命令</code>指的是一个执行某些特定事情的指令。</p> <p>  应用场景：需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道请求的操作是什么。核心就是<code>将请求发送者和接收者解耦</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> closeDoorCommand <span class="token operator">=</span> <span class="token punctuation">{</span>     
    <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'关门'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
 
<span class="token keyword">var</span> openPcCommand <span class="token operator">=</span> <span class="token punctuation">{</span>     
    <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'开电脑'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">var</span> openQQCommand <span class="token operator">=</span> <span class="token punctuation">{</span>     
    <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'登录 QQ'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//宏命令:命令模式和组合模式的产物。</span>
<span class="token keyword">var</span> <span class="token function-variable function">MacroCommand</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">return</span> <span class="token punctuation">{</span>         
        <span class="token literal-property property">commandsList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         
        <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">command</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>             
            <span class="token keyword">this</span><span class="token punctuation">.</span>commandsList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> command <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token punctuation">}</span><span class="token punctuation">,</span>         
        <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             
            <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> command<span class="token punctuation">;</span> command <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commandsList<span class="token punctuation">[</span> i<span class="token operator">++</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             
            <span class="token punctuation">}</span>         
        <span class="token punctuation">}</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
 
<span class="token keyword">var</span> macroCommand <span class="token operator">=</span> <span class="token function">MacroCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> closeDoorCommand <span class="token punctuation">)</span><span class="token punctuation">;</span> 
macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> openPcCommand <span class="token punctuation">)</span><span class="token punctuation">;</span> 
macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> openQQCommand <span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
macroCommand<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><hr> <h3 id="_7、组合模式"><a href="#_7、组合模式" class="header-anchor">#</a> 7、组合模式</h3> <p>  将对象组合成树形结构，以表示&quot;部分-整体&quot;的层次结构。通过对象的多态性表现，使得用户对单个对象和组合对象的使用具有一致性。</p> <p><strong>缺点</strong></p> <ul><li>系统中额每个对象看起来和其他对象都差不多。代码在运行起来的时候区别才会显示出来，使得代码难以理解。</li> <li>组合模式如果创建了太多的对象，可能会让系统负担不起。</li></ul> <p><strong>优点</strong></p> <ul><li><p>表示树形结构：提供了一种遍历树形结构的方案，通过调用组合对象的execute方法，程序会递归调用组合对象下面的叶对象的execute方法。</p></li> <li><p>利用对象多态性统一的对待组合对象和单个对象。对象的多态性表现，可以忽略组合对象和单个对象的不同。在组合模式中，不需要关心是组合对象还是单个对象。</p> <p><strong>组合模式使用场景</strong></p></li> <li><p>表示对象的部分-整体层次结构。</p></li> <li><p>客户希望统一对待树中的所有对象。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">MacroCommand</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">commandList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>commandList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>command<span class="token punctuation">;</span>command<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>commandList<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> openAcCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开空调&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      add：<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span> <span class="token string">'叶对象不能添加子节点'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> openTvCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开电视&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> openSoundCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;打开音响&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//组合命令1</span>
    <span class="token keyword">var</span> macroCommand1 <span class="token operator">=</span> <span class="token function">MacroCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openTvCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openSoundCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*********关门、打开电脑和打登录 QQ 的命令****************/</span>

    <span class="token keyword">var</span> closeDoorCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关门&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> openPcCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开电脑&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> openQQCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;登录 QQ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//组合命令2</span>
    <span class="token keyword">var</span> macroCommand2 <span class="token operator">=</span> <span class="token function">MacroCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>closeDoorCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openPcCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openQQCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*********现在把所有的命令组合成一个“超级命令”**********/</span>
	<span class="token comment">//超集组合命令</span>
    <span class="token keyword">var</span> macroCommand <span class="token operator">=</span> <span class="token function">MacroCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openAcCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>macroCommand1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    macroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>macroCommand2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*********最后给遥控器绑定“超级命令”**********/</span>

    <span class="token keyword">var</span> setCommand <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>macroCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>利用组合模式扫描文件夹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Folder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        file<span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始扫描文件夹:&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> file<span class="token punctuation">;</span> file <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> files<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>files<span class="token punctuation">,</span>len<span class="token operator">=</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>len<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> file<span class="token operator">=</span>files<span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">===</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                files<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>len<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//文件类</span>
<span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;文件下面不能再添加文件&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开始扫描文件&quot;</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件名为:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> files<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>files<span class="token punctuation">,</span>len<span class="token operator">=</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>len<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> file<span class="token operator">=</span>files<span class="token punctuation">[</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token operator">===</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                files<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>len<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> folder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'学习资料'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> folder1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'JavaScript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> folder2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'jQuery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> file1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'JavaScript 设计模式与开发实践'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> file2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'精通 jQuery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> file3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'重构与模式'</span><span class="token punctuation">)</span>


folder1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
folder2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file2<span class="token punctuation">)</span><span class="token punctuation">;</span>

folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>folder1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>folder2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> folder3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'Nodejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> file4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'深入浅出 Node.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
folder3<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file4<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> file5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'JavaScript 语言精髓与编程实践'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>folder3<span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file5<span class="token punctuation">)</span><span class="token punctuation">;</span>
folder1<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
folder<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="_8、模板方法模式"><a href="#_8、模板方法模式" class="header-anchor">#</a> 8、模板方法模式</h3> <p>  是一种只需要使用继承就可以实现的简单模式。</p> <p>  模板方法模式由两部分结构组成，第一部分是抽象类，第二部分是具体的实现子类。抽象父类中封装子类的算法框架，包括公共方法和子类中所有方法的执行顺序。子类通过继承抽象类，来继承整个算法结构，也可以选择重写父类的方法。</p> <p><strong>提示：</strong> 很多时候都不需要依样画瓢的去实现一个模板方法模式，高阶函数式更好的选择。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Beverage</span> <span class="token punctuation">{</span>
    <span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;把水煮沸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;子类必须重写brew方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">pourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;子类必须重写pourInCup 方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;子类必须重写 addCondiments 方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//钩子函数</span>
    <span class="token function">customerWantsCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 默认需要调料</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">customerWantsCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果挂钩返回 true，则需要调料</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">CoffeeWithHook</span> <span class="token keyword">extends</span> <span class="token class-name">Beverage</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">boilWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;把水煮沸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用沸水冲泡咖啡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">pourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;把咖啡倒进杯子&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">addCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'加糖和牛奶'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">customerWantsCondiments</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;请问需要调料吗？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> coffeeWithHook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoffeeWithHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
coffeeWithHook<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><hr> <h3 id="_9、享元模式"><a href="#_9、享元模式" class="header-anchor">#</a> 9、享元模式</h3> <p>​  享元（flyWeight）模式是一种用于<strong>性能优化</strong>的模式。其核心是运用<code>共享技术</code>来有效支持大量细粒度的对象。享元模式要求把对象的属性划分为内部状态和外部状态（状态也就是属性）。其目标是尽量减少共享对象的数量。</p> <p><strong>内部状态和外部状态的划分原则：</strong></p> <ul><li><p>内部状态存储于对象内部。</p></li> <li><p>内部状态被一些对象共享。</p></li> <li><p>内部状态独立于具体的场景，通常不会改变。</p></li> <li><p>外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享。</p> <p><strong>享元模式的适用性</strong></p></li> <li><p>一个程序中使用了大量的相似对象。</p></li> <li><p>由于使用了大量对象，造成了很大的内存开销。</p></li> <li><p>对象的大多数状态都可以变为外部状态。</p></li> <li><p>剥离出对象的外部状态之后，可以用相对较少的共享对象取代大量对象。</p></li></ul> <p><strong>1、享元模式之文件上传</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//创建共享对象（内部状态）</span>
<span class="token keyword">class</span> <span class="token class-name">Upload</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">uploadType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploadType <span class="token operator">=</span> uploadType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">delFile</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileSize <span class="token operator">&lt;</span> <span class="token number">3000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;确定要删除该文件吗? &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//创建上传类工厂</span>
<span class="token keyword">class</span> <span class="token class-name">UploadFactory</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>createdFlyWeightObjs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//创建共享对象</span>
    <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">uploadType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>createdFlyWeightObjs<span class="token punctuation">[</span>uploadType<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createdFlyWeightObjs<span class="token punctuation">[</span>uploadType<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>createdFlyWeightObjs<span class="token punctuation">[</span>uploadType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Upload</span><span class="token punctuation">(</span>uploadType<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createdFlyWeightObjs<span class="token punctuation">[</span>uploadType<span class="token punctuation">]</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//封装外部状态</span>
<span class="token keyword">class</span> <span class="token class-name">UploadManager</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploadDatabase <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> uploadType<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> fileSize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建享元对象</span>
        <span class="token keyword">const</span> uploadObj<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UploadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> flyWeightObj <span class="token operator">=</span> uploadObj<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>uploadType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> dom<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDivDom</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>fileName<span class="token punctuation">,</span>fileSize<span class="token punctuation">,</span>flyWeightObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploadDatabase<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">fileName</span><span class="token operator">:</span> fileName<span class="token punctuation">,</span>
            <span class="token literal-property property">fileSize</span><span class="token operator">:</span> fileSize<span class="token punctuation">,</span>
            <span class="token literal-property property">dom</span><span class="token operator">:</span> dom
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> flyWeightObj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">addDivDom</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>fileName<span class="token punctuation">,</span>fileSize<span class="token punctuation">,</span>flyWeightObj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;span&gt;文件名称: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 文件大小:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> &lt;/span&gt;&lt;button class=&quot;delFile&quot;&gt;删除&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

        dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.delFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setExternalState</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> flyWeightObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            flyWeightObj<span class="token punctuation">.</span><span class="token function">delFile</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//设置外部状态</span>
    <span class="token function">setExternalState</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> flyWeightObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> uploadData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uploadDatabase<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>uploadData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            flyWeightObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> uploadData<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">startUpload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">uploadType<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> uploadManager<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UploadManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> file<span class="token punctuation">;</span> <span class="token punctuation">(</span>file <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> uploadObj <span class="token operator">=</span> uploadManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
            <span class="token operator">++</span>id<span class="token punctuation">,</span>
            uploadType<span class="token punctuation">,</span>
            file<span class="token punctuation">.</span>fileName<span class="token punctuation">,</span>
            file<span class="token punctuation">.</span>fileSize
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">startUpload</span><span class="token punctuation">(</span><span class="token string">&quot;plugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;1.txt&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;2.html&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;3.txt&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startUpload</span><span class="token punctuation">(</span><span class="token string">&quot;flash&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;4.txt&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;5.html&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;6.txt&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//有多少种内部状态的组合，就有多少个共享对象。</span>
</code></pre></div><p><strong>2、对象池</strong></p> <p>  对象池也是一种性能优化方案，跟享元模式有一些相似之处，但是没有分离内部状态和外部状态。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ObjectPoolFactory</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">createObjFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>objectPool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">createObjFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> obj <span class="token operator">=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>objectPool<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span>
        <span class="token operator">?</span> <span class="token function">createObjFn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>objectPool<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//回收节点</span>
    <span class="token function">recover</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>objectPool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">createIframe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>

    iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iframe<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 防止 iframe 重复加载的 bug</span>
        <span class="token keyword">new</span> <span class="token class-name">ObjectPoolFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">recover</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// iframe 加载完成之后回收节点</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> iframe<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> ObjectPool<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectPoolFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iframe1<span class="token operator">=</span>ObjectPool<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIframe<span class="token punctuation">)</span><span class="token punctuation">;</span>

iframe1<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">'http://baidu.com'</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> iframe2<span class="token operator">=</span>ObjectPool<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
iframe2<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">'http://QQ.com'</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> iframe3<span class="token operator">=</span>ObjectPool<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createIframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
iframe3<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">'http://QQ.com'</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h3 id="_10、职责链模式"><a href="#_10、职责链模式" class="header-anchor">#</a> 10、职责链模式</h3> <p><strong>定义：</strong> 使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系，将这些对象连城一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。</p> <p><strong>优点：</strong></p> <ul><li>请求发送者只需要知道链中的第一个节点。弱化了发送者和一组接收者之间的强联系。</li> <li>链中的节点对象可以灵活拆分重组。</li> <li>可以手动指定起始节点，请求并不非得从链中的第一个节点开始传递。</li></ul> <p><strong>缺点：</strong></p> <ul><li>我们不能保证某个请求一定会被链中的节点处理。这种情况可以在链尾增加一个节点专门来处理异常。</li> <li>职责链可能会使得过程中会增加许多没有起到实质性作用的节点，会产生性能损耗。</li></ul> <p><strong>职责链模式的常用场景：</strong> 早高峰坐公交投币。（将硬币往前传递给售票员）</p> <p>实例：电商网站</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">{</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>fn<span class="token operator">=</span>fn<span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>successor <span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token function">setNextSuccessor</span><span class="token punctuation">(</span><span class="token parameter">successor</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token comment">//return 供链式调用</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successor <span class="token operator">=</span>successor 
     <span class="token punctuation">}</span>
     <span class="token function">passRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token comment">//判断执行结果是不是nextSuccessor，是的话，继续往下执行</span>
         <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token operator">===</span><span class="token string">&quot;nextSuccessor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
             <span class="token comment">//递归,直到val不等于nextSuccessor为止</span>
             <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successor<span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>successor<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>successor<span class="token punctuation">,</span>arguments<span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> val<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">order500</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>pay<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;500 元定金预购, 得到 100 优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">order200</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token operator">==</span><span class="token number">2</span><span class="token operator">&amp;&amp;</span>pay<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;200 元定金预购, 得到 50 优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">orderNormal</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>stock<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'普通购买，无优惠券'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'手机库存不足'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> chainOrder500 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span> order500 <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> chainOrder200 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span> order200 <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> chainOrderNormal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span> orderNormal <span class="token punctuation">)</span><span class="token punctuation">;</span> 
chainOrder500<span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span> chainOrder200 <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setNextSuccessor</span><span class="token punctuation">(</span> chainOrderNormal <span class="token punctuation">)</span><span class="token punctuation">;</span> 
chainOrder500<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出：500 元定金预购，得到 100 优惠券 </span>
chainOrder500<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出：200 元定金预购，得到 50 优惠券 </span>
chainOrder500<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出：普通购买，无优惠券 </span>
chainOrder500<span class="token punctuation">.</span><span class="token function">passRequest</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 输出：手机库存不足 </span>
</code></pre></div><p><strong>用AOP实现职责链</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">order500</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token operator">==</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>pay<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;500 元定金预购, 得到 100 优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">order200</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>orderType<span class="token operator">==</span><span class="token number">2</span><span class="token operator">&amp;&amp;</span>pay<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;200 元定金预购, 得到 50 优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'nextSuccessor'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">orderNormal</span> <span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">orderType<span class="token punctuation">,</span>pay<span class="token punctuation">,</span>stock</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>stock<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'普通购买，无优惠券'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'手机库存不足'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//切换编程</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">fn</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>     
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">===</span> <span class="token string">'nextSuccessor'</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>             
            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token punctuation">}</span> 
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">var</span> order <span class="token operator">=</span> order500<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span> order200 <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span> orderNormal <span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token function">order</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出：500 元定金预购，得到 100 优惠券 </span>
<span class="token function">order</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出：200 元定金预购，得到 50 优惠券 </span>
<span class="token function">order</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 输出：普通购买，无优惠券 </span>
</code></pre></div><hr> <h3 id="_11、中介者模式"><a href="#_11、中介者模式" class="header-anchor">#</a> 11、中介者模式</h3> <p>中介者模式的作用就是解除对象和对象之间的紧耦合关系。</p> <p><strong>优点：</strong> 以中介者和对象的一对多关系取代了对象之间的网状多对多关系。每个对象只需要关注自身功能的实现即可。对象之间的交互关系交给中介者来实现和维护。</p> <p><strong>缺点：</strong> 系统中会增加一个中介者对象，对象之间的交互复杂性，转移成了中介者对象的复杂性，使得中介者对象自身会成为一个难以维护的对象。</p> <p><strong>实例：用中介者模式实现泡泡堂游戏</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">class</span> <span class="token class-name">Player</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> teamColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>teamColor <span class="token operator">=</span> teamColor<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;alive&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">win</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">玩家</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">赢了</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">lose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">玩家</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">输了</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Player<span class="token punctuation">.</span>playDirector<span class="token punctuation">)</span><span class="token punctuation">{</span>
          Player<span class="token punctuation">.</span>playDirector<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PlayDirector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>    
        Player<span class="token punctuation">.</span>playDirector<span class="token punctuation">.</span><span class="token function">addPlayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;dead&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 给中介者发送消息，玩家死亡</span>
        Player<span class="token punctuation">.</span>playDirector<span class="token punctuation">.</span><span class="token function">playerDead</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">玩家</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">掉线了</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Player<span class="token punctuation">.</span>playDirector<span class="token punctuation">.</span><span class="token function">removePlayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">changeTeam</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">玩家</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">叛变了</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 给中介者发送消息，玩家换队</span>
        Player<span class="token punctuation">.</span>playDirector<span class="token punctuation">.</span><span class="token function">changeTeam</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    Player<span class="token punctuation">.</span>playDirector<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">PlayDirector</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>players <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">addPlayer</span><span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">;</span> <span class="token comment">//玩家额队伍颜色</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加玩家</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//移除玩家</span>
      <span class="token function">removePlayer</span><span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">;</span>
        <span class="token keyword">let</span> teamPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> index <span class="token operator">=</span> teamPlayers<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span>
        index<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> teamPlayers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//玩家换队</span>
      <span class="token function">changeTeam</span><span class="token punctuation">(</span><span class="token parameter">player<span class="token punctuation">,</span> newTeamColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removePlayer</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从原队伍中删除</span>
        player<span class="token punctuation">.</span>teamColor <span class="token operator">=</span> newTeamColor<span class="token punctuation">;</span> <span class="token comment">// 改变队伍颜色         operations.addPlayer( player );       // 增加到新队伍中</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//玩家死亡</span>
      <span class="token function">playerDead</span><span class="token punctuation">(</span><span class="token parameter">player</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 玩家死亡</span>
        <span class="token keyword">var</span> teamColor <span class="token operator">=</span> player<span class="token punctuation">.</span>teamColor<span class="token punctuation">,</span>
          teamPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>teamColor<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 玩家所在队伍</span>
        <span class="token keyword">var</span> all_dead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>player<span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token string">&quot;dead&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            all_dead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>all_dead <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         
          <span class="token comment">// 全部死亡</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            player<span class="token punctuation">.</span><span class="token function">lose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本队所有玩家 lose</span>
          <span class="token punctuation">}</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>teamColor<span class="token operator">+</span><span class="token string">&quot;队输了&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> color <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>color <span class="token operator">!==</span> teamColor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> teamPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>players<span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 其他队伍的玩家</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> player<span class="token punctuation">;</span> <span class="token punctuation">(</span>player <span class="token operator">=</span> teamPlayers<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                player<span class="token punctuation">.</span><span class="token function">win</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 其他队伍所有玩家 win</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//测试</span>
    <span class="token comment">// 红队： </span>
    <span class="token keyword">var</span> player1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'皮蛋'</span><span class="token punctuation">,</span> <span class="token string">'red'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'小乖'</span><span class="token punctuation">,</span> <span class="token string">'red'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'宝宝'</span><span class="token punctuation">,</span> <span class="token string">'red'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player4 <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'小强'</span><span class="token punctuation">,</span> <span class="token string">'red'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
    <span class="token comment">// 蓝队： </span>
    <span class="token keyword">var</span> player5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'黑妞'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'葱头'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'胖墩'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>     
    player8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Player</span><span class="token punctuation">(</span> <span class="token string">'海盗'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">//红队全部死亡</span>
    <span class="token comment">// player1.die(); </span>
    <span class="token comment">// player2.die(); </span>
    <span class="token comment">// player3.die(); </span>
    <span class="token comment">// player4.die();</span>

    <span class="token comment">//玩家 player1和player1掉线</span>
    <span class="token comment">// player1.remove();</span>
    <span class="token comment">// player2.remove(); </span>
    <span class="token comment">// player3.die(); </span>
    <span class="token comment">// player4.die(); </span>
    
    <span class="token comment">//玩家1叛变</span>
    player1<span class="token punctuation">.</span><span class="token function">changeTeam</span><span class="token punctuation">(</span> <span class="token string">'blue'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    player2<span class="token punctuation">.</span><span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    player3<span class="token punctuation">.</span><span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    player4<span class="token punctuation">.</span><span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_12、装饰器模式"><a href="#_12、装饰器模式" class="header-anchor">#</a> 12、装饰器模式</h3> <p>  给对象动态的增加职责的方式称为<code>装饰者模式</code>。装饰者模式能够在不改变对象自身的基础上，在程序运行期间给对象动态的添加职责。是一种<code>即用即付</code>的方式。</p> <p>  装饰者模式将一个对象嵌入到另一个对象中，实际上相当于这个对象被另一个对象包装起来，形成一条包装链。请求随着这条链依次传递到所有的对象，每个对象都有处理这条请求的机会。</p> <p><strong>1、模拟传统面向对象语言的装饰者模式</strong></p> <p>  分析：给对象动态增加职责的方式，并没有真正地改动对象自身，而是将对象放入另一个对象 之中，这些对象以一条链的方式进行引用，形成一个聚合对象。这些对象都拥有相同的接口（fire 方法），当请求达到链中的某个对象时，这个对象会执行自身的操作，随后把请求转发给链中的 下一个对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">Plane</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> 
<span class="token comment">//</span>
<span class="token class-name">Plane</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">fire</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'发射普通子弹'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//接下来增加两个装饰类，分别是导弹和原子弹： </span>
<span class="token keyword">var</span> <span class="token function-variable function">MissileDecorator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">plane</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">this</span><span class="token punctuation">.</span>plane <span class="token operator">=</span> plane<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>


<span class="token class-name">MissileDecorator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">fire</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">this</span><span class="token punctuation">.</span>plane<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'发射导弹'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//将一个对象放入另一个对象中</span>
<span class="token keyword">var</span> <span class="token function-variable function">AtomDecorator</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">plane</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">this</span><span class="token punctuation">.</span>plane <span class="token operator">=</span> plane<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//给对象动态添加职责</span>
<span class="token class-name">AtomDecorator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">fire</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">this</span><span class="token punctuation">.</span>plane<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'发射原子弹'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MissileDecorator</span><span class="token punctuation">(</span> plane <span class="token punctuation">)</span><span class="token punctuation">;</span> 
plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomDecorator</span><span class="token punctuation">(</span> plane <span class="token punctuation">)</span><span class="token punctuation">;</span> 
plane<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>2、装饰函数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token function">alert</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> _a <span class="token operator">=</span> a<span class="token punctuation">;</span> 
<span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token function">_a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token function">alert</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>装饰函数的优点：</strong></p> <p>​  将行为依照职责分成粒度更细的函数，随后通过装饰把它们合并到一起，这有助于我 们编写一个松耦合和高复用性的系统。</p> <p><strong>装饰函数缺点：</strong></p> <ul><li><p>必须维护中间变量，如果函数的装饰链较长，或者 需要装饰的函数变多，这些中间变量的数量也会越来越多。</p></li> <li><p>this 被劫持的问题。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> _getElementById <span class="token operator">=</span> document<span class="token punctuation">.</span>getElementById<span class="token punctuation">;</span> 
 
document<span class="token punctuation">.</span><span class="token function-variable function">getElementById</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">id</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token function">alert</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// (1)      </span>
    <span class="token keyword">return</span> <span class="token function">_getElementById</span><span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出： Uncaught TypeError: Illegal invocation       	</span>
<span class="token punctuation">}</span> 
 <span class="token comment">//document.getElementById方法的内部实现需要 使用 this 引用，this 在这个方法内预期是指向 document，而不是 window,调用_getElementById( id )方法时内部的this指向的是window。</span>
 
</code></pre></div><p><strong>3、用AOP装饰函数</strong>（给函数动态添加功能）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">before</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">beforefn</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">var</span> __self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// 保存原函数的引用     </span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// 返回包含了原函数和新函数的&quot;代理&quot;函数         </span>
        <span class="token function">beforefn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行新函数，且保证 this 不被劫持，新函数接受的参数,</span>
        <span class="token comment">//也会被原封不动地传入原函数，新函数在原函数之前执行(前置装饰) ，这样就实现了动态装饰的效果                                             </span>
        <span class="token keyword">return</span> <span class="token function">__self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行原函数并返回原函数的执行结果，并且保证 this 不被劫持    </span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//不污染原型的写法</span>
<span class="token keyword">var</span> <span class="token function-variable function">before</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">fn<span class="token punctuation">,</span> beforefn</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token function">beforefn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">afterfn</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">var</span> __self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>     
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">__self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token function">afterfn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>          
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">//不污染原型的写法</span>
<span class="token keyword">var</span> <span class="token function-variable function">after</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">fn<span class="token punctuation">,</span> beforefn</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token function">afterfn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> arguments <span class="token punctuation">)</span><span class="token punctuation">;</span>          
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//测试</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">before</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

a <span class="token operator">=</span> <span class="token function">before</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//顺序输出1,2,3</span>
</code></pre></div><p><strong>3、1 AOP的应用实例</strong></p> <p>  装饰行为依照职责分成粒度更细的函数，随后通过装饰把它们合并到一起，这有助于我 们编写一个松耦合和高复用性的系统。</p> <ul><li><p><strong>数据统计上报</strong></p> <p>分离业务代码和数据统计代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//业务代码</span>
<span class="token keyword">var</span> <span class="token function-variable function">showLogin</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'打开登录浮层'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token punctuation">}</span> 
<span class="token keyword">var</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'上报标签为: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span> <span class="token string">'tag'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token punctuation">}</span>
<span class="token comment">//数据统计代码</span>
showLogin <span class="token operator">=</span> showLogin<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span> log <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 打开登录浮层之后上报数据 </span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'button'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> showLogin<span class="token punctuation">;</span> 
</code></pre></div></li> <li><p><strong>用AOP动态改变函数的参数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">param</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> param <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出： {a: &quot;a&quot;, b: &quot;b&quot;}  </span>
<span class="token punctuation">}</span> 
func <span class="token operator">=</span> func<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">param</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    param<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//在调用func之前调用before</span>
<span class="token function">func</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><strong>插件式的表单验证</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">before</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">beforefn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> __self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">beforefn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// beforefn 返回 false 的情况直接 return，不再执行后面的原函数            </span>
             <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token function">__self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token comment">//代码验证</span>
<span class="token keyword">var</span> <span class="token function-variable function">validata</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'用户名不能为空'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'密码不能为空'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//代码提交</span>
<span class="token keyword">var</span> <span class="token function-variable function">formSubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> param <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> username<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> password<span class="token punctuation">.</span>value <span class="token punctuation">}</span>
    <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token string">'http:// xxx.com/login'</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//将代码验证和代码提交耦合性降低</span>
formSubmit <span class="token operator">=</span> formSubmit<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>validata<span class="token punctuation">)</span><span class="token punctuation">;</span>
submitBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">formSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p><strong>3.2 用AOP装饰函数的缺点</strong></p> <ul><li><p>通过 Function.prototype.before 或者 Function.prototype.after 被装 饰之后，返回的实际上是一个新的函数，如果在原函数上保存了一些属性，那么这些属性会丢失。因为原函数所指向的内存地址发生了变化，原函数指向了另一个函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
func<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
func <span class="token operator">=</span> func<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 输出：undefined </span>
</code></pre></div></li> <li><p>这种装饰方式也叠加了函数的作用域，如果装饰的链条过长，性能上也会受到一些 影响。</p></li></ul> <p><strong>4、装饰者模式和代理模式的区别</strong></p> <p><strong>相同点：</strong> 都描述了怎样为对象提供一定程度上的间接引用。它们的实现部分都保留了对另一个对象的引用（<code>返回一个函数</code>），并且向那个对象发送请求(<code>调用返回的函数</code>)。</p> <p><strong>区别：</strong> 最主要的区别在于设计目的和意图。</p> <ul><li>代理模式的目的在于当直接访问本体或者不方便访问本体时，为本体提供一个替代者，代理可以拦截一些对本体的访问请求。或者再访问本体之前做一些额外的事情。<code>代理模式强调的是一种在一开始就确定的静态关系</code>。代理模式通常只有一层<code>代理-本体</code>的引用。</li> <li>装饰者模式在一开始不能确定对象的全部功能。而装饰者模式常常会形成一条装饰者链。</li></ul> <h3 id="_13、状态模式"><a href="#_13、状态模式" class="header-anchor">#</a> 13、状态模式</h3> <p><strong>定义：</strong> 允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。</p> <p>状态模式的关键是<code>区分事物的内部状态</code>，因为事物内部状态的改变往往会引起事物行为的改变。</p> <p>状态模式的关键是把<code>事物的每种状态都封装成单独的类</code>，跟此类有关的行为都被封装在这个类的内部。</p> <p><strong>状态模式的通用结构</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">State</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token operator">=</span>light<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">buttonPress</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// this.light.setState( this.light.offLightState );</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>light<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span> state <span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">OffLightState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">WeakLightState</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">StrongLightState</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">SuperStrongLightState</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">light</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Light</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>offLightState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OffLightState</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 持有状态对象的引用    		   // 将对象保存为对象的属性。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>weakLightState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakLightState</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">this</span><span class="token punctuation">.</span>strongLightState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrongLightState</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>   
        <span class="token keyword">this</span><span class="token punctuation">.</span>superStrongLightState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperStrongLightState</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">this</span><span class="token punctuation">.</span>button <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>offLightState<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span><span class="token string">&quot;开关&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">buttonPress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> newState<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
light<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p><strong>状态模式的优缺点</strong></p> <p>​	<strong>缺点：</strong> 会在系统中定义许多状态类。</p> <p>​	<strong>优点</strong></p> <ul><li>状态模式定义了状态与行为之间的关系，并将它们封装在一个类里。通过增加新的状态 ，很容易增加新的状态和转换。</li> <li>避免 Context（Light类）无限膨胀，状态切换的逻辑被分布在状态类中，也去掉了 Context中原本过多的条件分支。</li> <li>用<strong>对象代替字符串来记录当前状态</strong>，使得状态的切换更加一目了然。</li> <li>Context中的请求动作和状态类中封装的行为可以非常容易地独立变化而互不影响。</li></ul> <p><strong>状态模式和策略模式的关系</strong></p> <p><strong>区别：</strong><code>策略模式</code>中的各个策略类之间是平等又平行的，它们之间没有任何联系， 所以客户必须熟知这些策略类的作用，以便客户可以随时主动切换算法。在<code>状态模式</code>中，状态 和状态对应的行为是早已被封装好的，状态之间的切换也早被规定完成，“改变行为”这件事情 发生在状态模式内部。</p> <p><strong>相同点：</strong> 都有一个上下文、一些策略或者状态类，上下文把请 求委托给这些类来执行。</p> <hr> <h3 id="_14、适配器模式"><a href="#_14、适配器模式" class="header-anchor">#</a> 14、适配器模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> guangdongCity <span class="token operator">=</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">shenzhen</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">guangzhou</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">zhuhai</span><span class="token operator">:</span> <span class="token number">13</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">getGuangdongCity</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> guangdongCity <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'shenzhen'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'guangzhou'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> guangdongCity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始渲染广东省地图'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">addressAdapter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">oldAddressfn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> oldAddress <span class="token operator">=</span> <span class="token function">oldAddressfn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">;</span> c <span class="token operator">=</span> oldAddress<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        address<span class="token punctuation">[</span>c<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token function">addressAdapter</span><span class="token punctuation">(</span>getGuangdongCity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>适配器模式、装饰者模式、代理模式和外观模式的区别</strong></p> <p><strong>相同点：</strong> 都属于<code>包装模式</code>。都是由一个对象来包装另一个对象。</p> <p><strong>区别：</strong></p> <ul><li><p><strong>适配器模式</strong>主要是用来解决两个接口之间不匹配的问题。不考虑这些接口是怎样实现的，也不考虑这些接口将来怎么变化。</p></li> <li><p><strong>装饰者模式和代理模式</strong>也不会改变原有对象的接口，但<strong>装饰者模式</strong>的作用是为了给对象增加功能。装饰者模式常常形成一条长的装饰链，而适配器模式通常只包装一次。<strong>代理模式</strong>是为了控制对对象的访问，通常也只包装一次。</p></li> <li><p>外观模式的作用和适配器比较相似，有人把外观模式看成一组对象的适配器，但外观模式显著的特点是<strong>定义了一个新的接口。</strong></p></li></ul> <h2 id="二、设计原则和编程技巧"><a href="#二、设计原则和编程技巧" class="header-anchor">#</a> 二、设计原则和编程技巧</h2> <h3 id="_1、第一职责原则"><a href="#_1、第一职责原则" class="header-anchor">#</a> 1、第一职责原则</h3> <p>​		第一职责原则（Single Resonsibility Principle——SRP），体现为一个对象（方法）只做一件事情。</p> <p>​		<strong>优点：</strong> 降低了单个类或对象的复杂度，按照职责将对象分解为更小的粒度，这有助于代码的复用，同时也有助于单元测试。这样当一个职责变更的时候，不会影响到其他的功能。降低了代码耦合度。</p> <p>​		<strong>不足：</strong> 会增加编写代码的复杂度。将对象按照职责分解成更小粒度后，同时也增加了这些对象互相联系的难度。</p> <p>​		设计模式中有用到第一职责原则的有<code>单例模式、代理模式、迭代器模式、装饰者模式</code>。</p> <h3 id="_2、最少知识原则"><a href="#_2、最少知识原则" class="header-anchor">#</a> 2、最少知识原则</h3> <p>​		最少知识原则（Least Knowledge Principle——LKP），指的是一个对象尽量减少与其他对象之间发生相互作用。</p> <p>​		设计模式中用到最少知识原则的是<code>中介者模式、外观模式、</code>。封装也是最少知识原则的一种体现。</p> <h3 id="_3、开放封闭原则"><a href="#_3、开放封闭原则" class="header-anchor">#</a> 3、开放封闭原则</h3> <p>​		开放封闭原则（Open Closed Principle——OCP）。当需要改变一个程序的功能或者说是要给该程序增加新功能时，可以使用增加代码的方式，但是不要不允许更改程序的原代码。</p> <p>​		AOP动态装饰函数就很好的运用到了开放闭合原则。</p> <p>​		开放闭合原则最重的就是把程序中变化的部分找出并封装起来，将程序中不变和变化的部分隔离开来。</p> <p>​		<strong>实行开放封闭原则的常见方法有：</strong></p> <ul><li><p>利用对象的多态性。</p></li> <li><p><strong>放置挂钩</strong>。在程序有可能发生变化的地方放置一个挂钩，挂钩的返回结果决定了程序的下一步走向</p></li> <li><p><strong>使用回调函数</strong>。以把一部分易于变化的逻辑封装在回调函数里，然后把回调函数当作参数传入一个稳定和封闭的函数中。当回调函数被执行的时候，程序就可以因为回调函数的内部逻辑不同，而产生不同的结果</p> <p>设计模式中用到开放闭合原则的主要有<code>发布订阅模式、模板方法模式、策略模式、代理模式、职责链模式</code>。</p></li></ul> <h3 id="_4、代码重构"><a href="#_4、代码重构" class="header-anchor">#</a> 4、代码重构</h3> <p>​			模式和重构有着一种与生俱来的关系，设计模式的行为的目标就是为了代码重构做准备。</p> <p>​	<strong>代码重构的主要手段</strong></p> <ul><li><p>提炼函数。</p></li> <li><p>合并重复的条件片段。</p></li> <li><p>把条件分支语句提炼成函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">isSummer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">6</span> <span class="token operator">&amp;&amp;</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">9</span><span class="token punctuation">;</span>     
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
 
<span class="token keyword">var</span> <span class="token function-variable function">getPrice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">price</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">isSummer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// 夏天         </span>
        <span class="token keyword">return</span> price <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span>     
    <span class="token keyword">return</span> price<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>合理使用循环。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">createXHR</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">var</span> versions<span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'MSXML2.XMLHttp.6.0ddd'</span><span class="token punctuation">,</span> <span class="token string">'MSXML2.XMLHttp.3.0'</span><span class="token punctuation">,</span> <span class="token string">'MSXML2.XMLHttp'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>     
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> version<span class="token punctuation">;</span> version <span class="token operator">=</span> versions<span class="token punctuation">[</span> i<span class="token operator">++</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">try</span><span class="token punctuation">{</span>             
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span> version <span class="token punctuation">)</span><span class="token punctuation">;</span>         
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 
        <span class="token punctuation">}</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
 
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token function">createXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>提前让函数退出代替嵌套条件分支 。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">del</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">obj</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">if</span> <span class="token punctuation">(</span> obj<span class="token punctuation">.</span>isReadOnly <span class="token punctuation">)</span><span class="token punctuation">{</span>    
        <span class="token comment">// 反转 if 表达式         </span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span>     
    <span class="token keyword">if</span> <span class="token punctuation">(</span> obj<span class="token punctuation">.</span>isFolder <span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">return</span> <span class="token function">deleteFolder</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span>     
    <span class="token keyword">if</span> <span class="token punctuation">(</span> obj<span class="token punctuation">.</span>isFile <span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">return</span> <span class="token function">deleteFile</span><span class="token punctuation">(</span> obj <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>传递对象参数代替过长的参数列表</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">setUserInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">obj</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'id= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>id <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'name= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'address= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>address <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'sex= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>sex <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'mobile= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>mobile <span class="token punctuation">)</span><span class="token punctuation">;</span>     
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'qq= '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>qq <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1314</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sven'</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">'shenzhen'</span><span class="token punctuation">,</span> <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token literal-property property">mobile</span><span class="token operator">:</span> <span class="token string">'137********'</span><span class="token punctuation">,</span> <span class="token literal-property property">qq</span><span class="token operator">:</span> <span class="token number">377876679</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div></li> <li><p>尽量减少参数数量</p></li> <li><p>少用三目运算符</p></li> <li><p>合理使用链式调用</p></li> <li><p>分解大型类</p></li> <li><p>用return 退出多重循环</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>         
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>             
            <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">*</span> j <span class="token operator">&gt;</span><span class="token number">30</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> 
                <span class="token comment">//避免有代码没有被执行</span>
                <span class="token keyword">return</span> <span class="token function">print</span><span class="token punctuation">(</span> i <span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token punctuation">}</span>         
        <span class="token punctuation">}</span>     
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><strong class="post-meta-item-text">阅读量： </strong> <span class="leancloud-visitors-count"></span></span></div> <h3><a href="javascript:;"></a>
    评 论：
  </h3> <div id="vcomments"></div></section></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/24/2024, 10:23:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/WebGLbolg/articles/javascript/javascript之深浅拷贝的区别.html" class="prev">
        javascript之深浅拷贝的区别
      </a></span> <span class="next"><a href="/WebGLbolg/articles/javascript/javascript之闭包.html">
        javascript之闭包
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/WebGLbolg/assets/js/app.a1e9572c.js" defer></script><script src="/WebGLbolg/assets/js/2.918eef7d.js" defer></script><script src="/WebGLbolg/assets/js/1.dd66940c.js" defer></script><script src="/WebGLbolg/assets/js/163.b6b640bb.js" defer></script><script src="/WebGLbolg/assets/js/107.54b8d7a7.js" defer></script>
  </body>
</html>
